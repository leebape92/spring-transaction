<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>유저 관리</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/js/common.js"></script> <!-- ajaxPost 함수 정의되어 있어야 함 -->
</head>
<body>

  <h2>유저 목록</h2>
  <button id="btnUserList">유저 조회</button>

  <div id="result"></div>

  <hr />

  <h2>유저 저장</h2>
  <form id="userForm">
    <label>Username: <input type="text" id="username" name="username" required></label><br><br>
    <label>Email: <input type="email" id="email" name="email"></label><br><br>
    <button type="button" id="btnUserSave">유저 저장</button>
  </form>

  <div id="saveResult"></div>

  <script>
    $(document).ready(function() {
      $("#btnUserList").on("click", btnUserList);
      $("#btnUserSave").on("click", btnUserSave);
    });

    function btnUserList() {
      $("#result").html("⏳ 유저 목록 조회 중...");

      ajaxPost("/user/findUserList", {}, function(data) {
        let html = "<h4>유저 목록</h4><ul>";
        data.forEach(user => {
          html += `<li>${user.username}</li>`;
        });
        html += "</ul>";
        $("#result").html(html);
      });
    }

    function btnUserSave() {
      const userData = {
        username: $("#username").val(),
        email: $("#email").val()
      };

      // 유효성 검사 (간단 예시)
      if (!userData.username) {
        alert("Username을 입력하세요.");
        return;
      }

      $("#saveResult").html("💾 저장 중...");

      ajaxPost("/user/saveUser", userData, function(response) {
        $("#saveResult").html("✅ 저장 성공!");
        $("#userForm")[0].reset(); // 폼 초기화
        btnUserList(); // 저장 후 목록 새로고침
      }, function(error) {
        $("#saveResult").html("❌ 저장 실패");
      });
    }
  </script>

</body>
</html>
