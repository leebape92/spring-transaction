<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>유저 관리</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/js/common.js"></script> <!-- ajaxPost 함수 정의되어 있어야 함 -->
</head>
<body>
<h2>메시지 관리</h2>

<h3>메시지 조회</h3>
<label>메시지 코드: <input type="text" id="searchMessageCode"></label>
<label>메시지 내용: <input type="text" id="searchMessageText"></label>
<button type="button" id="btnMessageSearch">메시지 조회</button>

<div id="messageResult"></div>

<h3>메시지 저장</h3>
<form id="messageForm">
  <label>메시지 코드: <input type="text" id="messageCode" name="messageCode" required></label><br><br>
  <label>메시지 내용: <input type="text" id="messageText" name="messageText" required></label><br><br>
  <button type="button" id="btnMessageSave">메시지 저장</button>
</form>

<div id="messageSaveResult"></div>

<button id="btnDeleteMessages">삭제</button>
<script>
$(document).ready(function() {
	  $("#btnMessageSearch").on("click", btnMessageSearch);
	  $("#btnMessageSave").on("click", btnMessageSave);
	  $("#btnDeleteMessages").on("click", btnMessagesDelete);  // 삭제 버튼 이벤트 바인딩 추가
	});

function btnMessageSearch() {
	  const searchParams = {
	    messageCode: $("#searchMessageCode").val(),
	    messageText: $("#searchMessageText").val()
	  };

	  ajaxGet("/message/findMessage", searchParams, function(response) {
	    debugger;

	    if (response.code !== "SUCCESS") {
	      alert("에러확인필요");
	      return;
	    }

	    const messages = response.data;
	    alert(response.message);

	    let html = "<h4>메시지 목록</h4><ul>";

	    messages.forEach(function(msg) {
	        html += `
	          <li>
	            <input type="checkbox" name="selectedMessages" value="${msg.messageCode}" id="${msg.messageCode}">
	            <label for="${msg.messageCode}"><strong>${msg.messageCode}</strong>: ${msg.messageText}</label>
	          </li>`;
	    });



	    html += "</ul>";

	    $("#messageResult").html(html);
	  }); // ✅ ajaxGet 콜백 함수 닫는 괄호
	} // ✅ btnMessageSearch 함수 닫는 중괄호


	function btnMessageSave() {
	  const messageData = {
	    messageCode: $("#messageCode").val(),
	    messageText: $("#messageText").val()
	  };

	  if (!messageData.messageCode || !messageData.messageText) {
	    alert("메시지 코드와 내용을 모두 입력하세요.");
	    return;
	  }

	  ajaxPost("/message/saveMessage", messageData, function(response) {
		  alert(response.message);
		  $("#messageForm")[0].reset();
		  btnMessageSearch(); //별도의 페이지 이동 or 금융권 그리드 저장후 재조회 하도록 ? 상황에 맞게
		});
	}
	

	function btnMessagesDelete() {
		  debugger;
		  const checkedBoxes = $("input[name='selectedMessages']:checked");
		  const selectedValues = checkedBoxes.map(function() {
		    return this.value;
		  }).get();

		  if (selectedValues.length === 0) {
		    alert("삭제할 메시지를 선택하세요.");
		    return;
		  }

		  // messageCode 프로퍼티를 가진 객체 배열로 변환
		  const requestData = selectedValues.map(code => ({ messageCode: code }));

		  ajaxPost("/message/deleteMessages", requestData, function(response) {
		    if (response.code === "SUCCESS") {
		      alert("메시지가 성공적으로 삭제되었습니다.");
		      btnMessageSearch();
		    } else {
		      alert("삭제 실패: " + response.message);
		    }
		  });
		}




</script>
</body>
</html>
