<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>ìœ ì € ê´€ë¦¬</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/js/common.js"></script> <!-- ajaxPost í•¨ìˆ˜ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨ -->
</head>
<body>
<h2>ë©”ì‹œì§€ ê´€ë¦¬</h2>

<h3>ë©”ì‹œì§€ ì¡°íšŒ</h3>
<label>ë©”ì‹œì§€ ì½”ë“œ: <input type="text" id="searchMessageCode"></label>
<label>ë©”ì‹œì§€ ë‚´ìš©: <input type="text" id="searchMessageText"></label>
<button type="button" id="btnMessageSearch">ë©”ì‹œì§€ ì¡°íšŒ</button>

<div id="messageResult"></div>

<h3>ë©”ì‹œì§€ ì €ì¥</h3>
<form id="messageForm">
  <label>ë©”ì‹œì§€ ì½”ë“œ: <input type="text" id="messageCode" name="messageCode" required></label><br><br>
  <label>ë©”ì‹œì§€ ë‚´ìš©: <input type="text" id="messageText" name="messageText" required></label><br><br>
  <button type="button" id="btnMessageSave">ë©”ì‹œì§€ ì €ì¥</button>
</form>

<div id="messageSaveResult"></div>

<script>
$(document).ready(function() {
	  $("#btnMessageSearch").on("click", btnMessageSearch);
	  $("#btnMessageSave").on("click", btnMessageSave);
	});

	function btnMessageSearch() {
	  const searchParams = {
	    messageCode: $("#searchMessageCode").val(),
	    messageText: $("#searchMessageText").val()
	  };

	  $("#messageResult").html("ğŸ” ë©”ì‹œì§€ ì¡°íšŒ ì¤‘...");

	  ajaxGet("/message/findMessage", searchParams, function(data) {
	    if (data.length === 0) {
	      $("#messageResult").html("â—ì¡°íšŒëœ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.");
	      return;
	    }

	    let html = "<h4>ë©”ì‹œì§€ ëª©ë¡</h4><ul>";
	    data.forEach(msg => {
	      html += `<li><strong>${msg.messageCode}</strong>: ${msg.messageText}</li>`;
	    });
	    html += "</ul>";
	    $("#messageResult").html(html);
	  }, function(err) {
	    $("#messageResult").html("âŒ ë©”ì‹œì§€ ì¡°íšŒ ì‹¤íŒ¨");
	  });
	}

	function btnMessageSave() {
	  const messageData = {
	    messageCode: $("#messageCode").val(),
	    messageText: $("#messageText").val()
	  };

	  if (!messageData.messageCode || !messageData.messageText) {
	    alert("ë©”ì‹œì§€ ì½”ë“œì™€ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
	    return;
	  }

	  $("#messageSaveResult").html("ğŸ’¾ ì €ì¥ ì¤‘...");

	  ajaxPost("/message/saveMessage", messageData, function(response) {
	    $("#messageSaveResult").html("âœ… ë©”ì‹œì§€ ì €ì¥ ì„±ê³µ!");
	    $("#messageForm")[0].reset();
	    btnMessageSearch(); // ì €ì¥ í›„ ëª©ë¡ ê°±ì‹ 
	  }, function(error) {
	    $("#messageSaveResult").html("âŒ ë©”ì‹œì§€ ì €ì¥ ì‹¤íŒ¨");
	  });
	}

</script>
</body>
</html>
