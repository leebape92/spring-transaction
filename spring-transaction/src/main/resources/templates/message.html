<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>유저 관리</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/js/common.js"></script> <!-- ajaxPost 함수 정의되어 있어야 함 -->
</head>
<body>
<h2>메시지 관리</h2>

<h3>메시지 조회</h3>
<label>메시지 코드: <input type="text" id="searchMessageCode"></label>
<label>메시지 내용: <input type="text" id="searchMessageText"></label>
<button type="button" id="btnMessageSearch">메시지 조회</button>

<div id="messageResult"></div>

<h3>메시지 저장</h3>
<form id="messageForm">
  <label>메시지 코드: <input type="text" id="messageCode" name="messageCode" required></label><br><br>
  <label>메시지 내용: <input type="text" id="messageText" name="messageText" required></label><br><br>
  <button type="button" id="btnMessageSave">메시지 저장</button>
</form>

<div id="messageSaveResult"></div>

<script>
$(document).ready(function() {
	  $("#btnMessageSearch").on("click", btnMessageSearch);
	  $("#btnMessageSave").on("click", btnMessageSave);
	});

	function btnMessageSearch() {
	  const searchParams = {
	    messageCode: $("#searchMessageCode").val(),
	    messageText: $("#searchMessageText").val()
	  };

	  $("#messageResult").html("🔍 메시지 조회 중...");

	  ajaxGet("/message/findMessage", searchParams, function(data) {
	    if (data.length === 0) {
	      $("#messageResult").html("❗조회된 메시지가 없습니다.");
	      return;
	    }

	    let html = "<h4>메시지 목록</h4><ul>";
	    data.forEach(msg => {
	      html += `<li><strong>${msg.messageCode}</strong>: ${msg.messageText}</li>`;
	    });
	    html += "</ul>";
	    $("#messageResult").html(html);
	  }, function(err) {
	    $("#messageResult").html("❌ 메시지 조회 실패");
	  });
	}

	function btnMessageSave() {
	  const messageData = {
	    messageCode: $("#messageCode").val(),
	    messageText: $("#messageText").val()
	  };

	  if (!messageData.messageCode || !messageData.messageText) {
	    alert("메시지 코드와 내용을 모두 입력하세요.");
	    return;
	  }

	  $("#messageSaveResult").html("💾 저장 중...");

	  ajaxPost("/message/saveMessage", messageData, function(response) {
	    $("#messageSaveResult").html("✅ 메시지 저장 성공!");
	    $("#messageForm")[0].reset();
	    btnMessageSearch(); // 저장 후 목록 갱신
	  }, function(error) {
	    $("#messageSaveResult").html("❌ 메시지 저장 실패");
	  });
	}

</script>
</body>
</html>
